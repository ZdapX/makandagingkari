<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-950 text-white flex items-center justify-center min-h-screen p-6">
    <div class="w-full max-w-lg bg-gray-900 p-8 rounded-3xl border border-gray-800 shadow-2xl">
        <h1 class="text-3xl font-bold text-center mb-8 text-blue-500">AI Studio</h1>
        
        <div class="flex mb-6 bg-gray-800 p-1 rounded-xl">
            <button onclick="changeMode('text')" id="btnText" class="flex-1 py-2 rounded-lg bg-blue-600 text-white font-bold transition">Text to Image</button>
            <button onclick="changeMode('image')" id="btnImage" class="flex-1 py-2 rounded-lg text-gray-400 font-bold transition">Image to Image</button>
        </div>

        <div id="imageInput" class="hidden mb-4">
            <label class="block text-sm mb-2 text-gray-400">Pilih Foto Referensi:</label>
            <input type="file" id="file" class="w-full bg-gray-800 p-2 rounded-lg text-sm border border-gray-700">
        </div>

        <div class="mb-6">
            <label class="block text-sm mb-2 text-gray-400">Instruksi AI (Prompt):</label>
            <textarea id="prompt" class="w-full bg-gray-800 p-4 rounded-xl border border-gray-700 focus:ring-2 focus:ring-blue-500 outline-none h-32" placeholder="Contoh: Seorang astronot naik kuda di bulan, gaya cyberpunk..."></textarea>
        </div>

        <button onclick="generate()" id="submitBtn" class="w-full bg-blue-600 hover:bg-blue-700 py-4 rounded-2xl font-bold transition flex items-center justify-center gap-2">
            Mulai Buat Gambar
        </button>

        <div id="status" class="hidden mt-6 text-center text-blue-400 animate-pulse text-sm font-medium">
            Proses ini memakan waktu Â±1 menit. Jangan tutup halaman ini...
        </div>

        <div id="result" class="hidden mt-8">
            <img id="resImg" src="" class="w-full rounded-2xl border border-gray-700 shadow-lg">
            <a id="download" href="#" target="_blank" class="block text-center mt-4 text-sm text-blue-400 hover:underline underline-offset-4">Buka Resolusi Penuh</a>
        </div>
    </div>

    <script>
        let mode = 'text';

        function changeMode(m) {
            mode = m;
            document.getElementById('imageInput').className = m === 'image' ? 'block mb-4' : 'hidden';
            document.getElementById('btnText').className = m === 'text' ? 'flex-1 py-2 rounded-lg bg-blue-600 text-white font-bold transition' : 'flex-1 py-2 rounded-lg text-gray-400 font-bold transition';
            document.getElementById('btnImage').className = m === 'image' ? 'flex-1 py-2 rounded-lg bg-blue-600 text-white font-bold transition' : 'flex-1 py-2 rounded-lg text-gray-400 font-bold transition';
        }

        async function generate() {
            const prompt = document.getElementById('prompt').value;
            const file = document.getElementById('file').files[0];
            const btn = document.getElementById('submitBtn');
            const status = document.getElementById('status');
            const result = document.getElementById('result');

            if (!prompt) return alert("Prompt harus diisi!");

            btn.disabled = true;
            btn.innerText = "Sedang Menghubungi Server...";
            status.classList.remove('hidden');
            result.classList.add('hidden');

            let base64 = null;
            if (mode === 'image' && file) {
                base64 = await new Promise(resolve => {
                    const reader = new FileReader();
                    reader.onload = () => resolve(reader.result);
                    reader.readAsDataURL(file);
                });
            }

            try {
                const res = await fetch('/api/generate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ mode, prompt, imageBase64: base64 })
                });

                const data = await res.json();
                if (data.status) {
                    document.getElementById('resImg').src = data.result_url;
                    document.getElementById('download').href = data.result_url;
                    result.classList.remove('hidden');
                } else {
                    alert("Error: " + data.msg);
                }
            } catch (e) {
                alert("Server Timeout (Batas Vercel 10 detik terlampaui). Coba lagi beberapa saat lagi.");
            } finally {
                btn.disabled = false;
                btn.innerText = "Mulai Buat Gambar";
                status.classList.add('hidden');
            }
        }
    </script>
</body>
</html>
