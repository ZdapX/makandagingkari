<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Image Transformer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .glass { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .loader { border-top-color: #3b82f6; animation: spinner 1.5s linear infinite; }
        @keyframes spinner { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-slate-950 text-slate-200 min-h-screen flex items-center justify-center p-4">

    <div class="max-w-2xl w-full">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-extrabold text-white mb-2 tracking-tight">
                AI <span class="text-blue-500">Image</span> Studio
            </h1>
            <p class="text-slate-400">Ubah fotomu menjadi karya seni dengan bantuan AI</p>
        </div>

        <div class="glass rounded-3xl p-6 md:p-8 shadow-2xl">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                
                <!-- Left Side: Inputs -->
                <div class="space-y-5">
                    <div>
                        <label class="block text-sm font-semibold mb-2 text-slate-300">1. Upload Foto Asal</label>
                        <div class="relative group">
                            <input type="file" id="fileInput" accept="image/*" 
                                class="hidden" onchange="previewImage(this)">
                            <label for="fileInput" class="flex flex-col items-center justify-center w-full h-40 border-2 border-dashed border-slate-700 rounded-2xl cursor-pointer group-hover:border-blue-500 group-hover:bg-blue-500/5 transition-all">
                                <div id="uploadPlaceholder" class="flex flex-col items-center">
                                    <i class="fas fa-cloud-upload-alt text-3xl mb-2 text-slate-500 group-hover:text-blue-400"></i>
                                    <span class="text-xs text-slate-500 uppercase font-bold tracking-wider">Klik untuk Upload</span>
                                </div>
                                <img id="preview" class="hidden w-full h-full object-cover rounded-2xl">
                            </label>
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-semibold mb-2 text-slate-300">2. Instruksi (Prompt)</label>
                        <textarea id="prompt" 
                            class="w-full bg-slate-900 border border-slate-700 rounded-xl p-3 text-sm focus:ring-2 focus:ring-blue-500 focus:outline-none transition-all h-28" 
                            placeholder="Contoh: change my photo to ghibli studio anime style, high quality, masterpiece..."></textarea>
                    </div>

                    <button onclick="generate()" id="btn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 rounded-xl shadow-lg shadow-blue-900/20 transition-all flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed">
                        <i class="fas fa-magic"></i>
                        <span>Generate Artwork</span>
                    </button>
                </div>

                <!-- Right Side: Result -->
                <div class="flex flex-col justify-center items-center border-t md:border-t-0 md:border-l border-slate-800 pt-6 md:pt-0 md:pl-6">
                    <div id="loading" class="hidden text-center">
                        <div class="loader ease-linear rounded-full border-4 border-t-4 border-slate-800 h-12 w-12 mb-4 mx-auto"></div>
                        <p class="text-sm text-blue-400 font-medium">Sedang memproses...</p>
                        <p class="text-[10px] text-slate-500 mt-1 uppercase tracking-widest">Bisa memakan waktu hingga 1 menit</p>
                    </div>

                    <div id="resultContainer" class="hidden w-full text-center">
                        <p class="text-xs font-bold text-green-500 mb-3 uppercase tracking-widest">Hasil Generasi:</p>
                        <img id="resImg" src="" class="w-full rounded-2xl shadow-2xl border border-slate-700 mb-4 transform transition hover:scale-[1.02]">
                        <a id="downloadBtn" href="#" target="_blank" class="inline-flex items-center gap-2 text-sm text-blue-400 hover:text-white transition">
                            <i class="fas fa-external-link-alt"></i> Buka Full Resolution
                        </a>
                    </div>

                    <div id="idleMsg" class="text-center text-slate-600">
                        <i class="fas fa-wand-sparkles text-4xl mb-3 opacity-20"></i>
                        <p class="text-sm">Hasil akan muncul di sini</p>
                    </div>
                </div>

            </div>
        </div>

        <!-- Footer Info -->
        <p class="text-center mt-6 text-slate-500 text-xs">
            &copy; 2024 AI Studio - Menggunakan Nano Banana Model
        </p>
    </div>

    <script>
        function previewImage(input) {
            const preview = document.getElementById('preview');
            const placeholder = document.getElementById('uploadPlaceholder');
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.src = e.target.result;
                    preview.classList.remove('hidden');
                    placeholder.classList.add('hidden');
                }
                reader.readAsDataURL(input.files[0]);
            }
        }

        async function generate() {
            const fileInput = document.getElementById('fileInput');
            const promptInput = document.getElementById('prompt');
            const btn = document.getElementById('btn');
            const loading = document.getElementById('loading');
            const resultContainer = document.getElementById('resultContainer');
            const idleMsg = document.getElementById('idleMsg');

            if (!fileInput.files[0]) return alert("Silakan pilih gambar terlebih dahulu!");
            if (!promptInput.value) return alert("Masukkan prompt (perintah) untuk AI!");

            // UI State
            btn.disabled = true;
            loading.classList.remove('hidden');
            resultContainer.classList.add('hidden');
            idleMsg.classList.add('hidden');

            const reader = new FileReader();
            reader.readAsDataURL(fileInput.files[0]);
            reader.onload = async () => {
                const base64 = reader.result;

                try {
                    const response = await fetch('/api/generate', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ 
                            prompt: promptInput.value, 
                            imageBase64: base64 
                        })
                    });

                    const data = await response.json();

                    if (data.status && data.result_url) {
                        document.getElementById('resImg').src = data.result_url;
                        document.getElementById('downloadBtn').href = data.result_url;
                        resultContainer.classList.remove('hidden');
                    } else {
                        alert("Error: " + (data.msg || "Gagal memproses gambar. Coba lagi."));
                        idleMsg.classList.remove('hidden');
                    }
                } catch (error) {
                    console.error(error);
                    alert("Terjadi kesalahan koneksi atau timeout Vercel.");
                    idleMsg.classList.remove('hidden');
                } finally {
                    btn.disabled = false;
                    loading.classList.add('hidden');
                }
            };
        }
    </script>
</body>
</html>
